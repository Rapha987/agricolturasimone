<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoCare Pro | Piattaforma Manutenzione & Ricambi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* === CSS ESPANSO PER PIATTAFORMA MULTI-SERVIZIO === */
    :root {
      --primary: #4fd1ff;
      --primary-dark: #0066ff;
      --secondary: #00ff9d;
      --accent: #ff4fd6;
      --warning: #ffaa00;
      --danger: #ff5555;
      --dark-bg: #02010a;
      --darker: #0a0f2c;
      --card-bg: rgba(20, 25, 60, 0.7);
      --gradient: linear-gradient(135deg, var(--primary), var(--primary-dark));
      --gradient-ev: linear-gradient(135deg, #00ff9d, #00cc7a);
      --gradient-china: linear-gradient(135deg, #ff3366, #ff9900);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--dark-bg);
      color: white;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* === NAVBAR ESPANSA === */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      background: rgba(10, 15, 44, 0.95);
      backdrop-filter: blur(10px);
      z-index: 1000;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      gap: 30px;
    }

    .nav-link {
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 8px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-link:hover {
      background: rgba(79, 209, 255, 0.1);
      color: var(--primary);
    }

    .nav-link.active {
      background: var(--gradient);
      color: white;
    }

    /* === DASHBOARD LATERALE === */
    .dashboard {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 30px;
      margin-top: 30px;
    }

    .sidebar {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-section h3 {
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 15px;
      color: var(--primary);
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .category-list {
      list-style: none;
    }

    .category-item {
      padding: 12px 15px;
      margin: 5px 0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-item:hover {
      background: rgba(79, 209, 255, 0.1);
    }

    .category-item.active {
      background: var(--gradient);
      color: white;
    }

    .category-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    .badge-ev { background: rgba(0, 255, 157, 0.2); color: var(--secondary); }
    .badge-ice { background: rgba(79, 209, 255, 0.2); color: var(--primary); }
    .badge-china { background: rgba(255, 51, 102, 0.2); color: #ff3366; }
    .badge-new { background: rgba(255, 170, 0, 0.2); color: var(--warning); }

    /* === GRIGLIA PRODOTTI === */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }

    .product-card {
      background: var(--card-bg);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .product-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .product-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 2;
    }

    .product-image {
      height: 200px;
      background: linear-gradient(45deg, #0a0f2c, #151a28);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .product-image img {
      max-width: 80%;
      max-height: 80%;
      object-fit: contain;
      transition: transform 0.5s;
    }

    .product-card:hover .product-image img {
      transform: scale(1.1);
    }

    .product-info {
      padding: 20px;
    }

    .product-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .product-description {
      opacity: 0.8;
      font-size: 0.9rem;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .product-specs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .spec {
      padding: 4px 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      font-size: 0.8rem;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .product-price {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }

    .btn-add-to-cart {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-add-to-cart:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(79, 209, 255, 0.3);
    }

    /* === CARRELLO FLOTTANTE === */
    .cart-floating {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--gradient);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      transition: all 0.3s;
    }

    .cart-floating:hover {
      transform: translateY(-5px);
    }

    .cart-count {
      background: white;
      color: var(--primary-dark);
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* === MODALE CARRELLO === */
    .cart-modal {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: var(--darker);
      box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
      transition: right 0.3s ease-in-out;
      z-index: 1001;
      padding: 30px;
      overflow-y: auto;
    }

    .cart-modal.open {
      right: 0;
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .cart-items {
      max-height: 60vh;
      overflow-y: auto;
    }

    .cart-item {
      display: flex;
      gap: 15px;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-item-details {
      flex: 1;
    }

    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-total {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid var(--primary);
    }

    .btn-checkout {
      width: 100%;
      padding: 15px;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s;
    }

    .btn-checkout:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(79, 209, 255, 0.3);
    }

    /* === SEZIONI SPECIALI === */
    .hero-banner {
      background: linear-gradient(rgba(10, 15, 44, 0.9), rgba(10, 15, 44, 0.9)), 
                  url('https://images.unsplash.com/photo-1555212697-194d092e3b8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
      background-size: cover;
      border-radius: 25px;
      padding: 60px 40px;
      margin: 40px 0;
      text-align: center;
    }

    .hero-banner h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
    }

    .stat-number {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    /* === RESPONSIVE === */
    @media (max-width: 1024px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: static;
      }
      
      .cart-modal {
        width: 100%;
        right: -100%;
      }
    }

    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        gap: 20px;
      }
      
      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- NAVBAR COMPLETA -->
    <nav class="navbar">
      <div class="logo">
        <i class="fas fa-car" style="color: var(--primary); font-size: 1.8rem;"></i>
        <h1>AutoCare Pro</h1>
      </div>
      
      <div class="nav-links">
        <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
          <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="#abbonamenti" class="nav-link" onclick="showSection('abbonamenti')">
          <i class="fas fa-sync-alt"></i> Abbonamenti
        </a>
        <a href="#ricambi" class="nav-link" onclick="showSection('ricambi')">
          <i class="fas fa-cogs"></i> Ricambi
        </a>
        <a href="#auto-nuove" class="nav-link" onclick="showSection('auto-nuove')">
          <i class="fas fa-bolt"></i> Auto Elettriche
        </a>
        <a href="#cinese" class="nav-link" onclick="showSection('cinese')">
          <i class="fas fa-flag"></i> Made in China
        </a>
        <a href="#assistenza" class="nav-link" onclick="showSection('assistenza')">
          <i class="fas fa-headset"></i> Assistenza
        </a>
      </div>
      
      <div class="cart-floating" onclick="toggleCart()">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
        <span>Carrello</span>
      </div>
    </nav>

    <!-- MODALE CARRELLO -->
    <div class="cart-modal" id="cartModal">
      <div class="cart-header">
        <h2><i class="fas fa-shopping-cart"></i> Il tuo carrello</h2>
        <button onclick="toggleCart()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="cart-items" id="cartItems">
        <!-- Elementi carrello dinamici -->
      </div>
      
      <div class="cart-total">
        <h3>Totale: <span id="cartTotal">‚Ç¨0.00</span></h3>
        <button class="btn-checkout" onclick="checkout()">
          <i class="fas fa-lock"></i> Procedi al pagamento
        </button>
      </div>
    </div>

    <!-- SEZIONI DINAMICHE -->
    <div id="contentSections">
      <!-- DASHBOARD PRINCIPALE -->
      <section id="dashboard" class="content-section active">
        <div class="hero-banner">
          <h2>Piattaforma Completa Auto<br>Manutenzione & Ricambi</h2>
          <p>Abbonamenti, ricambi originali, auto elettriche e soluzioni cinesi in un'unica piattaforma</p>
        </div>

        <div class="dashboard">
          <!-- SIDEBAR CATEGORIE -->
          <div class="sidebar">
            <div class="sidebar-section">
              <h3><i class="fas fa-filter"></i> CATEGORIE</h3>
              <ul class="category-list">
                <li class="category-item active" onclick="filterProducts('all')">
                  <i class="fas fa-th"></i> Tutti i prodotti
                  <span class="category-badge badge-new">124</span>
                </li>
                <li class="category-item" onclick="filterProducts('ev')">
                  <i class="fas fa-bolt"></i> Auto Elettriche
                  <span class="category-badge badge-ev">28</span>
                </li>
                <li class="category-item" onclick="filterProducts('ice')">
                  <i class="fas fa-gas-pump"></i> Ricambi Termici
                  <span class="category-badge badge-ice">56</span>
                </li>
                <li class="category-item" onclick="filterProducts('china')">
                  <i class="fas fa-flag"></i> Made in China
                  <span class="category-badge badge-china">32</span>
                </li>
                <li class="category-item" onclick="filterProducts('maintenance')">
                  <i class="fas fa-tools"></i> Kit Manutenzione
                </li>
                <li class="category-item" onclick="filterProducts('subscription')">
                  <i class="fas fa-sync-alt"></i> Abbonamenti
                </li>
              </ul>
            </div>

            <div class="sidebar-section">
              <h3><i class="fas fa-car"></i> MARCA AUTO</h3>
              <ul class="category-list">
                <li class="category-item">Tesla</li>
                <li class="category-item">BYD</li>
                <li class="category-item">MG Motor</li>
                <li class="category-item">Volkswagen</li>
                <li class="category-item">Fiat</li>
                <li class="category-item">BMW</li>
                <li class="category-item">Mercedes</li>
              </ul>
            </div>

            <div class="sidebar-section">
              <h3><i class="fas fa-tags"></i> OFFERTE</h3>
              <ul class="category-list">
                <li class="category-item">
                  <i class="fas fa-fire" style="color: #ff3366;"></i> Flash Sale
                </li>
                <li class="category-item">
                  <i class="fas fa-shipping-fast" style="color: #00ff9d;"></i> Spedizione Gratis
                </li>
                <li class="category-item">
                  <i class="fas fa-percentage" style="color: #ffaa00;"></i> Sconti Fino al 40%
                </li>
              </ul>
            </div>
          </div>

          <!-- GRIGLIA PRODOTTI -->
          <div class="main-content">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number">1.2K+</div>
                <p>Ricambi in catalogo</p>
              </div>
              <div class="stat-card">
                <div class="stat-number">45</div>
                <p>Modelli EV disponibili</p>
              </div>
              <div class="stat-card">
                <div class="stat-number">28</div>
                <p>Brand cinesi certificati</p>
              </div>
              <div class="stat-card">
                <div class="stat-number">2.4K</div>
                <p>Clienti soddisfatti</p>
              </div>
            </div>

            <h2 style="margin: 30px 0 20px;">Prodotti in evidenza</h2>
            <div class="products-grid" id="productsGrid">
              <!-- Prodotti caricati dinamicamente -->
            </div>
          </div>
        </div>
      </section>

      <!-- SEZIONE ABBONAMENTI -->
      <section id="abbonamenti" class="content-section">
        <div class="hero-banner" style="background: linear-gradient(rgba(10, 15, 44, 0.9), rgba(10, 15, 44, 0.9)), url('https://images.unsplash.com/photo-1563720223488-8f2f62a6e71a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');">
          <h2>Abbonamenti Manutenzione</h2>
          <p>Piani personalizzati per ogni tipo di veicolo</p>
        </div>
        
        <div class="plans-grid" id="subscriptionsGrid" style="margin: 40px 0;">
          <!-- Abbonamenti caricati dinamicamente -->
        </div>
      </section>

      <!-- SEZIONE AUTO ELETTRICHE -->
      <section id="auto-nuove" class="content-section">
        <div class="hero-banner" style="background: linear-gradient(rgba(10, 15, 44, 0.9), rgba(10, 15, 44, 0.9)), url('https://images.unsplash.com/photo-1560958089-b8a1929cea89?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');">
          <h2>Auto Elettriche & Ibride</h2>
          <p>Novit√† 2024-2025 con consegna in 30 giorni</p>
        </div>
        
        <div class="cars-grid" id="evCarsGrid" style="margin: 40px 0;">
          <!-- Auto elettriche caricate dinamicamente -->
        </div>
      </section>

      <!-- SEZIONE MADE IN CHINA -->
      <section id="cinese" class="content-section">
        <div class="hero-banner" style="background: linear-gradient(rgba(10, 15, 44, 0.9), rgba(10, 15, 44, 0.9)), url('https://images.unsplash.com/photo-1601042879364-f3947d1f9fc9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');">
          <h2>Made in China - Premium Quality</h2>
          <p>Ricambi certificati per auto cinesi e non solo</p>
        </div>
        
        <div class="china-grid" id="chinaPartsGrid" style="margin: 40px 0;">
          <!-- Ricambi cinesi caricati dinamicamente -->
        </div>
      </section>
    </div>
  </div>

  <script>
    // ===== DATABASE COMPLETO PRODOTTI =====
    const productsDatabase = {
      all: [
        // AUTO ELETTRICHE
        {
          id: 'ev001',
          name: 'BYD Seal Excellence',
          category: 'ev',
          type: 'auto',
          price: 49900,
          image: 'byd-seal.png',
          description: 'Berlina elettrica premium, autonomia 520km, accelerazione 0-100 in 5.9s',
          specs: ['520km WLTP', '313 CV', '5.9s 0-100', 'Bat. 82.5 kWh'],
          badge: 'EV',
          badgeColor: '#00ff9d',
          brand: 'BYD',
          delivery: '30 giorni',
          warranty: '8 anni batteria'
        },
        {
          id: 'ev002',
          name: 'MG4 Electric',
          category: 'ev',
          type: 'auto',
          price: 34900,
          image: 'mg4.png',
          description: 'Compact EV con piattaforma MSP, design sportivo',
          specs: ['450km WLTP', '204 CV', '7.7s 0-100', 'Bat. 64 kWh'],
          badge: 'BEST SELLER',
          badgeColor: '#ff3366',
          brand: 'MG Motor',
          delivery: '15 giorni',
          warranty: '7 anni'
        },
        {
          id: 'ev003',
          name: 'Tesla Model 3 RWD',
          category: 'ev',
          type: 'auto',
          price: 45900,
          image: 'tesla-model3.png',
          description: 'Icona elettrica, tecnologia Autopilot, supercriche veloci',
          specs: ['491km WLTP', '283 CV', '6.1s 0-100', 'Bat. 60 kWh'],
          badge: 'SUPERCHARGER',
          badgeColor: '#ffaa00',
          brand: 'Tesla',
          delivery: '45 giorni',
          warranty: '8 anni/160k km'
        },

        // RICAMBI TERMICI EUROPEI
        {
          id: 'ice001',
          name: 'Kit Distribuzione Completo',
          category: 'ice',
          type: 'ricambio',
          price: 289,
          image: 'kit-distribuzione.png',
          description: 'Kit distribuzione completo per VW Golf 1.6 TDI',
          specs: ['Compatibile VW/Audi', 'Gates Original', 'Cinghia + tenditori', 'Made in Germany'],
          badge: 'OE QUALITY',
          badgeColor: '#4fd1ff',
          brand: 'Gates',
          compatibility: 'VW, Audi, Seat, Skoda',
          stock: 'Disponibile'
        },
        {
          id: 'ice002',
          name: 'Freni Brembo Kit',
          category: 'ice',
          type: 'ricambio',
          price: 450,
          image: 'freni-brembo.png',
          description: 'Kit dischi e pastiglie anteriori Brembo',
          specs: ['Dischi ventilati', 'Pastiglie sport', 'Per auto sportive', 'Made in Italy'],
          badge: 'PERFORMANCE',
          badgeColor: '#ff5555',
          brand: 'Brembo',
          compatibility: 'BMW, Mercedes, Audi',
          stock: '24h'
        },

        // RICAMBI CINESI
        {
          id: 'china001',
          name: 'Batteria Litio 12V',
          category: 'china',
          type: 'ricambio',
          price: 189,
          image: 'batteria-litio.png',
          description: 'Batteria al litio 12V per auto elettriche/ibride',
          specs: ['Lifepo4', '5kg peso', '3000 cicli', 'CE certificato'],
          badge: 'MADE IN CHINA',
          badgeColor: '#ff9900',
          brand: 'CATL',
          compatibility: 'BYD, MG, NIO',
          stock: 'Disponibile'
        },
        {
          id: 'china002',
          name: 'Display Touchscreen 10"',
          category: 'china',
          type: 'ricambio',
          price: 320,
          image: 'display-touch.png',
          description: 'Display Android Auto/Apple CarPlay per qualsiasi auto',
          specs: ['Android 12', '4GB RAM', '4G LTE', 'Retrofit universale'],
          badge: 'SMART UPGRADE',
          badgeColor: '#00ff9d',
          brand: 'Joying',
          compatibility: 'Universale',
          stock: 'Disponibile'
        },

        // ABBONAMENTI
        {
          id: 'sub001',
          name: 'EV Care Plus',
          category: 'subscription',
          type: 'abbonamento',
          price: 129,
          image: 'ev-care.png',
          description: 'Manutenzione completa auto elettriche',
          specs: ['2 controlli batteria/anno', 'Sostituzione fluidi', 'Diagnostica annuale', 'Assistenza 24/7'],
          badge: 'ABBONAMENTO',
          badgeColor: '#0066ff',
          brand: 'AutoCare',
          duration: '12 mesi',
          includes: ['Batteria check', 'Sistemi EV', 'Freni rigenerativi']
        },
        {
          id: 'sub002',
          name: 'Full Protection',
          category: 'subscription',
          type: 'abbonamento',
          price: 89,
          image: 'full-protection.png',
          description: 'Protezione totale per auto termiche',
          specs: ['2 cambi olio', 'Controllo freni', 'Diagnostica computerizzata', 'Soccorso stradale'],
          badge: 'POPOLARE',
          badgeColor: '#ff3366',
          brand: 'AutoCare',
          duration: '12 mesi',
          includes: ['Olio e filtri', 'Controlli sicurezza', 'Assistenza']
        }
      ]
    };

    // ===== CARRELLO =====
    let cart = JSON.parse(localStorage.getItem('autocare_cart')) || [];

    // ===== INIZIALIZZAZIONE =====
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      updateCartDisplay();
      initializeFilters();
      loadSubscriptions();
      loadEVCars();
      loadChinaParts();
    });

    // ===== GESTIONE SEZIONI =====
    function showSection(sectionId) {
      // Aggiorna navbar
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Mostra sezione
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ===== CARICAMENTO PRODOTTI =====
    function loadProducts(filter = 'all') {
      const grid = document.getElementById('productsGrid');
      if (!grid) return;
      
      let filteredProducts = productsDatabase.all;
      
      if (filter !== 'all') {
        filteredProducts = productsDatabase.all.filter(p => p.category === filter);
      }
      
      grid.innerHTML = filteredProducts.map(product => `
        <div class="product-card">
          ${product.badge ? `<div class="product-badge" style="background: ${product.badgeColor}">${product.badge}</div>` : ''}
          
          <div class="product-image">
            <i class="fas fa-${product.type === 'auto' ? 'car' : product.type === 'ricambio' ? 'cog' : 'sync-alt'}" 
               style="font-size: 4rem; color: ${product.badgeColor || '#4fd1ff'}; opacity: 0.7;"></i>
          </div>
          
          <div class="product-info">
            <h3 class="product-title">${product.name}</h3>
            <p class="product-description">${product.description}</p>
            
            <div class="product-specs">
              ${product.specs.map(spec => `<span class="spec">${spec}</span>`).join('')}
            </div>
            
            <div class="product-footer">
              <div>
                <div class="product-price">‚Ç¨${product.price.toLocaleString('it-IT')}</div>
                <small style="opacity: 0.7;">${product.brand} ‚Ä¢ ${product.stock || product.delivery || product.duration}</small>
              </div>
              <button class="btn-add-to-cart" onclick="addToCart('${product.id}')">
                <i class="fas fa-cart-plus"></i> Aggiungi
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ===== FILTRI =====
    function initializeFilters() {
      const filterItems = document.querySelectorAll('.category-item');
      filterItems.forEach(item => {
        item.addEventListener('click', function() {
          filterItems.forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          
          const filter = this.getAttribute('onclick').match(/'([^']+)'/)[1];
          loadProducts(filter);
        });
      });
    }

    // ===== CARICAMENTO SEZIONI SPECIALI =====
    function loadSubscriptions() {
      const grid = document.getElementById('subscriptionsGrid');
      if (!grid) return;
      
      const subscriptions = productsDatabase.all.filter(p => p.category === 'subscription');
      
      grid.innerHTML = subscriptions.map(sub => `
        <div class="product-card" style="max-width: 350px; margin: 0 auto;">
          <div class="product-image" style="background: linear-gradient(45deg, #0066ff, #4fd1ff);">
            <i class="fas fa-sync-alt" style="font-size: 5rem; color: white;"></i>
          </div>
          <div class="product-info">
            <h3>${sub.name}</h3>
            <p>${sub.description}</p>
            <div class="price" style="font-size: 2.5rem; color: #4fd1ff;">‚Ç¨${sub.price}/anno</div>
            <button class="btn-add-to-cart" onclick="addToCart('${sub.id}')" style="width: 100%;">
              <i class="fas fa-shopping-cart"></i> Attiva abbonamento
            </button>
          </div>
        </div>
      `).join('');
    }

    function loadEVCars() {
      const grid = document.getElementById('evCarsGrid');
      if (!grid) return;
      
      const evCars = productsDatabase.all.filter(p => p.category === 'ev');
      
      grid.innerHTML = evCars.map(car => `
        <div class="product-card">
          <div class="product-image" style="background: linear-gradient(45deg, #00cc7a, #00ff9d);">
            <i class="fas fa-car" style="font-size: 5rem; color: white;"></i>
          </div>
          <div class="product-info">
            <h3>${car.name}</h3>
            <p>${car.description}</p>
            <div style="margin: 15px 0;">
              <strong>Consegna: ${car.delivery}</strong><br>
              <strong>Garanzia: ${car.warranty}</strong>
            </div>
            <div class="product-footer">
              <div class="product-price">‚Ç¨${car.price.toLocaleString('it-IT')}</div>
              <button class="btn-add-to-cart" onclick="addToCart('${car.id}')">
                <i class="fas fa-car"></i> Configura
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function loadChinaParts() {
      const grid = document.getElementById('chinaPartsGrid');
      if (!grid) return;
      
      const chinaParts = productsDatabase.all.filter(p => p.category === 'china');
      
      grid.innerHTML = chinaParts.map(part => `
        <div class="product-card">
          <div class="product-image" style="background: linear-gradient(45deg, #ff3366, #ff9900);">
            <i class="fas fa-flag" style="font-size: 4rem; color: white;"></i>
          </div>
          <div class="product-info">
            <h3>${part.name}</h3>
            <p>${part.description}</p>
            <div class="product-specs">
              ${part.specs.map(spec => `<span class="spec">${spec}</span>`).join('')}
            </div>
            <div style="margin: 10px 0; font-size: 0.9rem;">
              <i class="fas fa-check-circle" style="color: #00ff9d;"></i> Certificato CE<br>
              <i class="fas fa-shipping-fast" style="color: #4fd1ff;"></i> ${part.stock}
            </div>
            <div class="product-footer">
              <div class="product-price">‚Ç¨${part.price}</div>
              <button class="btn-add-to-cart" onclick="addToCart('${part.id}')">
                <i class="fas fa-shopping-cart"></i> Acquista
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ===== GESTIONE CARRELLO =====
    function addToCart(productId) {
      const product = productsDatabase.all.find(p => p.id === productId);
      if (!product) return;
      
      const existingItem = cart.find(item => item.id === productId);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          ...product,
          quantity: 1,
          addedAt: new Date().toISOString()
        });
      }
      
      saveCart();
      updateCartDisplay();
      showNotification(`‚úÖ ${product.name} aggiunto al carrello!`, 'success');
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      saveCart();
      updateCartDisplay();
      showNotification('üóëÔ∏è Prodotto rimosso dal carrello', 'warning');
    }

    function updateQuantity(productId, delta) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          saveCart();
          updateCartDisplay();
        }
      }
    }

    function saveCart() {
      localStorage.setItem('autocare_cart', JSON.stringify(cart));
    }

    function updateCartDisplay() {
      // Aggiorna contatore
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = totalItems;
      
      // Aggiorna modale carrello
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      
      if (cartItems && cartTotal) {
        if (cart.length === 0) {
          cartItems.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 40px;">Il carrello √® vuoto</p>';
          cartTotal.textContent = '‚Ç¨0.00';
        } else {
          cartItems.innerHTML = cart.map(item => `
            <div class="cart-item">
              <div class="cart-item-image">
                <i class="fas fa-${item.type === 'auto' ? 'car' : item.type === 'ricambio' ? 'cog' : 'sync-alt'}" 
                   style="font-size: 2rem; color: #4fd1ff;"></i>
              </div>
              <div class="cart-item-details">
                <h4>${item.name}</h4>
                <p style="font-size: 0.9rem; opacity: 0.8;">${item.brand} ‚Ä¢ ‚Ç¨${item.price}</p>
                <div class="cart-item-quantity">
                  <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                  <span>${item.quantity}</span>
                  <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                  <button onclick="removeFromCart('${item.id}')" style="margin-left: 20px; background: none; border: none; color: #ff5555; cursor: pointer;">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          `).join('');
          
          const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
          cartTotal.textContent = `‚Ç¨${total.toLocaleString('it-IT', { minimumFractionDigits: 2 })}`;
        }
      }
    }

    function toggleCart() {
      document.getElementById('cartModal').classList.toggle('open');
      if (document.getElementById('cartModal').classList.contains('open')) {
        updateCartDisplay();
      }
    }

    // ===== CHECKOUT =====
    async function checkout() {
      if (cart.length === 0) {
        showNotification('üõí Il carrello √® vuoto!', 'warning');
        return;
      }
      
      // Raggruppa prodotti per tipo
      const subscriptions = cart.filter(item => item.type === 'abbonamento');
      const products = cart.filter(item => item.type !== 'abbonamento');
      
      if (subscriptions.length > 0) {
        // Per abbonamenti, usa il flusso esistente
        showNotification('üîó Reindirizzamento a checkout abbonamenti...', 'info');
        // Qui potresti reindirizzare alla pagina checkout esistente
        setTimeout(() => {
          window.location.href = '#paymentSection';
          toggleCart();
        }, 1000);
      } else {
        // Per prodotti fisici, crea ordine
        const orderId = 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
        
        const orderData = {
          orderId: orderId,
          items: cart,
          total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
          timestamp: new Date().toISOString()
        };
        
        // Salva ordine nel localStorage (in produzione salveresti su backend)
        localStorage.setItem('last_order', JSON.stringify(orderData));
        
        // Svuota carrello
        cart = [];
        saveCart();
        updateCartDisplay();
        
        // Mostra conferma
        showNotification(`üéâ Ordine #${orderId} creato! Ti contatteremo per la spedizione.`, 'success');
        toggleCart();
        
        // Potresti reindirizzare a pagina riepilogo ordine
        setTimeout(() => {
          alert(`Ordine confermato!\nID: ${orderId}\nTotale: ‚Ç¨${orderData.total}\n\nRiceverai una email con i dettagli di spedizione.`);
        }, 500);
      }
    }

    // ===== NOTIFICAZIONI =====
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.innerHTML = `
        <div style="
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${type === 'success' ? '#00cc88' : type === 'warning' ? '#ffaa00' : '#4fd1ff'};
          color: white;
          padding: 15px 25px;
          border-radius: 10px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.3);
          z-index: 10000;
          animation: slideIn 0.3s ease-out;
          display: flex;
          align-items: center;
          gap: 15px;
          max-width: 400px;
        ">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // ===== API INTEGRATION (ESEMPIO) =====
    async function loadRealProductsFromAPI() {
      try {
        // Esempio chiamata API prodotti reali
        const response = await fetch('https://api.tuo-backend.com/products', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer TUO_TOKEN',
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        // Gestisci i dati reali...
        
      } catch (error) {
        console.error('Errore caricamento prodotti:', error);
        showNotification('‚ö†Ô∏è Errore nel caricamento prodotti', 'warning');
      }
    }

    // ===== INTEGRAZIONE CON IL SISTEMA ESISTENTE =====
    function integrateWithExistingSystem() {
      // Qui puoi integrare con il codice esistente di pagamento Stripe
      console.log('Sistema integrato con Stripe payments');
      
      // Esempio: quando un utente completa il checkout
      // chiama la funzione processPayment() esistente
    }

    // ===== FUNZIONI ESPORTATE =====
    window.showSection = showSection;
    window.filterProducts = loadProducts;
    window.addToCart = addToCart;
    window.removeFromCart = removeFromCart;
    window.updateQuantity = updateQuantity;
    window.toggleCart = toggleCart;
    window.checkout = checkout;
    window.showNotification = showNotification;
  </script>
</body>
</html>
