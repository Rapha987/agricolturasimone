<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoCare | Maintenance as a Service</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* === CSS MIGLIORATO CON SEZIONE PAGAMENTI === */
    :root {
      --primary: #4fd1ff;
      --primary-dark: #0066ff;
      --secondary: #00ff9d;
      --accent: #ff4fd6;
      --warning: #ffaa00;
      --success: #00cc88;
      --dark-bg: #02010a;
      --darker: #0a0f2c;
      --card-bg: rgba(20, 25, 60, 0.7);
      --glass: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.15);
      --gradient: linear-gradient(135deg, var(--primary), var(--primary-dark));
      --gradient-hover: linear-gradient(135deg, #5fd8ff, #0077ff);
      --gradient-ev: linear-gradient(135deg, #00ff9d, #00cc7a);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      --shadow-glow: 0 0 30px rgba(79, 209, 255, 0.3);
      --shadow-glow-ev: 0 0 30px rgba(0, 255, 157, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }

    body {
      font-family: 'Inter', sans-serif;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(79, 209, 255, 0.1) 0%, transparent 40%),
        radial-gradient(ellipse at 80% 80%, rgba(0, 255, 157, 0.1) 0%, transparent 40%),
        radial-gradient(circle at top, var(--darker), var(--dark-bg));
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* HEADER */
    header {
      padding: 30px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 40px;
      animation: slideIn 0.8s ease-out;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: var(--gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .logo h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.8rem;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      text-align: center;
      margin-top: 10px;
      opacity: 0.8;
      letter-spacing: 3px;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    /* HERO */
    .hero {
      text-align: center;
      padding: 40px 0 60px;
      max-width: 800px;
      margin: 0 auto;
      animation: slideIn 1s ease-out 0.2s both;
    }

    .hero h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 20px;
    }

    .hero span {
      color: var(--primary);
      position: relative;
    }

    .hero span::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--gradient);
    }

    .hero p {
      font-size: 1.2rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* CARDS */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      margin: 30px auto;
      box-shadow: var(--shadow);
      animation: slideIn 1s ease-out 0.4s both;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient);
    }

    .card label {
      display: block;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* INPUT */
    input {
      width: 100%;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      margin: 15px 0;
      font-size: 1rem;
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-family: 'Orbitron', monospace;
      letter-spacing: 2px;
      transition: all 0.3s ease;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 209, 255, 0.2);
    }

    /* BUTTONS */
    .btn-primary {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 20px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 102, 255, 0.3);
    }

    /* VEHICLE RESULT */
    #vehicleResult {
      text-align: center;
    }

    .vehicle-icon {
      font-size: 48px;
      color: var(--primary);
      margin-bottom: 20px;
    }

    #vehicleType {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.4rem;
      color: var(--secondary);
      padding: 12px 24px;
      background: rgba(0, 255, 157, 0.1);
      border-radius: 12px;
      display: inline-block;
      margin: 20px 0;
      border: 2px solid var(--secondary);
    }

    /* PLANS */
    .plans {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
      animation: slideIn 1s ease-out 0.6s both;
    }

    .plan {
      background: rgba(30, 35, 70, 0.7);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .plan:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: var(--shadow), var(--shadow-glow);
    }

    .plan.highlight {
      border: 2px solid var(--primary);
      transform: scale(1.03);
      box-shadow: var(--shadow), var(--shadow-glow);
    }

    .plan.ev {
      border: 2px solid var(--secondary);
    }

    .plan h4 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .price {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      display: block;
      margin: 15px 0;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .plan.ev .price {
      background: var(--gradient-ev);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* PAGAMENTI SECTION - NUOVA */
    #paymentSection {
      max-width: 800px;
      margin: 40px auto;
      animation: slideIn 0.8s ease-out;
    }

    .payment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .payment-header h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
    }

    .amount-display {
      background: rgba(0, 255, 157, 0.1);
      padding: 12px 24px;
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      color: var(--secondary);
      border: 2px solid var(--secondary);
    }

    .payment-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .payment-method {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid transparent;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .payment-method:hover {
      background: rgba(79, 209, 255, 0.1);
      border-color: var(--primary);
    }

    .payment-method.selected {
      background: rgba(79, 209, 255, 0.15);
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(79, 209, 255, 0.2);
    }

    .payment-icon {
      font-size: 40px;
      color: var(--primary);
    }

    .payment-icon.card { color: #00ff9d; }
    .payment-icon.paypal { color: #009cde; }
    .payment-icon.apple { color: #ffffff; }
    .payment-icon.google { color: #ea4335; }

    /* STRIPE ELEMENTI */
    .stripe-element {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 16px 20px;
      margin: 20px 0;
      transition: all 0.3s ease;
    }

    .stripe-element.focused {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 209, 255, 0.2);
    }

    .payment-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* CONFIRMATION */
    #confirmation {
      text-align: center;
      border: 2px solid var(--secondary);
      box-shadow: var(--shadow), var(--shadow-glow-ev);
    }

    .confirmation-icon {
      font-size: 60px;
      color: var(--secondary);
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }

    .confirmation-details {
      background: rgba(0, 255, 157, 0.1);
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid rgba(0, 255, 157, 0.2);
    }

    #transactionId {
      font-family: 'Orbitron', monospace;
      letter-spacing: 1px;
      color: var(--primary);
      margin-top: 10px;
      display: block;
    }

    /* FOOTER */
    footer {
      text-align: center;
      padding: 40px 0;
      margin-top: 60px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      opacity: 0.7;
      font-size: 0.9rem;
    }

    .payment-security {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
      opacity: 0.8;
    }

    .security-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
    }

    /* UTILITY */
    .hidden {
      display: none !important;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .plans, .payment-methods, .payment-details {
        grid-template-columns: 1fr;
      }
      
      .hero h2 {
        font-size: 2.2rem;
      }
      
      .logo h1 {
        font-size: 2.2rem;
      }
      
      .payment-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-car"></i>
        </div>
        <h1>AutoCare</h1>
      </div>
      <div class="tagline">Maintenance as a Service</div>
    </header>

    <!-- HERO -->
    <section class="hero">
      <h2>La manutenzione dell'auto<br><span>entra nel futuro</span></h2>
      <p>Abbonamenti intelligenti per auto termiche ed elettriche</p>
    </section>

    <!-- INPUT CARD -->
    <section class="card" id="inputSection">
      <label for="plate"><i class="fas fa-search"></i> INSERISCI LA TARGA</label>
      <input type="text" id="plate" placeholder="AB123CD" maxlength="7">
      <button class="btn-primary" onclick="detectVehicle()">
        <i class="fas fa-bolt"></i> Analizza veicolo
      </button>
    </section>

    <!-- VEHICLE RESULT -->
    <section class="card hidden" id="vehicleResult">
      <div class="vehicle-icon">
        <i class="fas fa-car-side"></i>
      </div>
      <h3>Veicolo rilevato</h3>
      <div id="vehicleType"></div>
      <button class="btn-primary" onclick="showPlans()">
        <i class="fas fa-arrow-right"></i> Continua
      </button>
    </section>

    <!-- PLANS -->
    <section class="plans hidden" id="plans">
      <!-- I piani saranno generati dinamicamente -->
    </section>

    <!-- SEZIONE PAGAMENTO (NUOVA) -->
    <section class="card hidden" id="paymentSection">
      <div class="payment-header">
        <h3><i class="fas fa-credit-card"></i> Completamento Pagamento</h3>
        <div class="amount-display" id="paymentAmount">â‚¬0</div>
      </div>
      
      <div class="payment-methods">
        <div class="payment-method" onclick="selectPaymentMethod('card')" id="cardMethod">
          <i class="payment-icon card fas fa-credit-card"></i>
          <div>
            <strong>Carta di Credito</strong>
            <p>Visa, Mastercard, American Express</p>
          </div>
        </div>
        
        <div class="payment-method" onclick="selectPaymentMethod('paypal')" id="paypalMethod">
          <i class="payment-icon paypal fab fa-paypal"></i>
          <div>
            <strong>PayPal</strong>
            <p>Pagamento rapido e sicuro</p>
          </div>
        </div>
        
        <div class="payment-method" onclick="selectPaymentMethod('apple')" id="appleMethod">
          <i class="payment-icon apple fab fa-apple"></i>
          <div>
            <strong>Apple Pay</strong>
            <p>Per dispositivi Apple</p>
          </div>
        </div>
        
        <div class="payment-method" onclick="selectPaymentMethod('google')" id="googleMethod">
          <i class="payment-icon google fab fa-google"></i>
          <div>
            <strong>Google Pay</strong>
            <p>Per dispositivi Android</p>
          </div>
        </div>
      </div>

      <!-- FORM CARTA DI CREDITO (Stripe Elements) -->
      <div id="cardForm" class="hidden">
        <div class="form-group">
          <label for="card-element"><i class="fas fa-credit-card"></i> DETTAGLI CARTA</label>
          <div id="card-element" class="stripe-element"></div>
          <div id="card-errors" style="color: #ff5555; margin-top: 10px;"></div>
        </div>

        <div class="payment-details">
          <div class="form-group">
            <label for="cardholder-name"><i class="fas fa-user"></i> INTESTATARIO CARTA</label>
            <input type="text" id="cardholder-name" placeholder="Mario Rossi">
          </div>
          
          <div class="form-group">
            <label for="email"><i class="fas fa-envelope"></i> EMAIL DI RICEVUTA</label>
            <input type="email" id="email" placeholder="tu@email.com">
          </div>
        </div>

        <button class="btn-primary" onclick="processPayment()" id="payButton">
          <i class="fas fa-lock"></i> Paga ora
        </button>
      </div>

      <!-- ALTRI METODI DI PAGAMENTO -->
      <div id="paypalButton" class="hidden">
        <button class="btn-primary" onclick="processPayPal()" style="background: linear-gradient(135deg, #009cde, #003087);">
          <i class="fab fa-paypal"></i> Paga con PayPal
        </button>
      </div>

      <div id="applePayButton" class="hidden">
        <button class="btn-primary" onclick="processApplePay()" style="background: #000; color: white;">
          <i class="fab fa-apple"></i> Paga con Apple Pay
        </button>
      </div>

      <div id="googlePayButton" class="hidden">
        <button class="btn-primary" onclick="processGooglePay()" style="background: #ea4335; color: white;">
          <i class="fab fa-google"></i> Paga con Google Pay
        </button>
      </div>

      <div style="margin-top: 30px; opacity: 0.7; text-align: center;">
        <i class="fas fa-shield-alt"></i> Pagamento sicuro SSL 256-bit
      </div>
    </section>

    <!-- CONFIRMATION -->
    <section class="card hidden" id="confirmation">
      <div class="confirmation-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3>Abbonamento attivato!</h3>
      <div class="confirmation-details">
        <p id="summary"></p>
        <p style="margin-top: 15px; font-size: 0.9rem;">
          <strong>ID Transazione:</strong>
          <span id="transactionId">TRX-2026-XXXX-XXXX</span>
        </p>
      </div>
      <p>Riceverai una email con tutti i dettagli. Ti contatteremo per il primo intervento.</p>
      <button class="btn-primary" onclick="resetFlow()" style="margin-top: 20px; background: rgba(255,255,255,0.1);">
        <i class="fas fa-redo"></i> Torna alla home
      </button>
    </section>

    <!-- FOOTER -->
    <footer>
      <p>Â© 2026 AutoCare Platform â€“ Europe Ready</p>
      <div class="payment-security">
        <div class="security-badge">
          <i class="fas fa-lock"></i> <span>Pagamenti sicuri</span>
        </div>
        <div class="security-badge">
          <i class="fas fa-shield-alt"></i> <span>Critografia SSL</span>
        </div>
        <div class="security-badge">
          <i class="fas fa-check-circle"></i> <span>GDPR Compliant</span>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // ===== STRIPE CONFIGURATION =====
    // SOSTITUIRE CON LA TUA PUBLISHABLE KEY DI STRIPE
    const stripe = Stripe('pk_test_51P...'); // TEST KEY - DA CAMBIARE
    const elements = stripe.elements();
    let cardElement;

    // ===== DATI APP =====
    let currentVehicleType = '';
    let selectedPlan = null;
    let selectedPaymentMethod = 'card';
    let paymentIntentId = null;

    // Database veicoli simulato
    const vehicleDatabase = {
      'AB123CD': { type: 'ICE', brand: 'Fiat', model: '500' },
      'EF456GH': { type: 'EV', brand: 'Tesla', model: 'Model 3' },
      'IJ789KL': { type: 'HYBRID', brand: 'Toyota', model: 'Prius' }
    };

    // Piani disponibili
    const plansData = [
      { name: 'Oil Basic', type: 'ICE', price: 79, desc: '1 cambio olio / anno' },
      { name: 'Oil Plus', type: 'ICE', price: 119, desc: '2 cambi + filtri', highlight: true },
      { name: 'EV Care', type: 'EV', price: 129, desc: 'Check EV & fluidi', ev: true }
    ];

    // ===== FUNZIONI PRINCIPALI =====
    function detectVehicle() {
      const plate = document.getElementById('plate').value.toUpperCase();
      
      if (!plate) {
        alert("Inserisci una targa valida");
        return;
      }

      // Simula chiamata API
      setTimeout(() => {
        let vehicleInfo;
        if (vehicleDatabase[plate]) {
          vehicleInfo = vehicleDatabase[plate];
        } else {
          vehicleInfo = { type: Math.random() > 0.5 ? 'ICE / IBRIDA' : 'EV' };
        }

        currentVehicleType = vehicleInfo.type;
        
        document.getElementById('vehicleType').innerHTML = `
          <strong>Tipo veicolo:</strong> ${currentVehicleType}<br>
          ${vehicleInfo.brand ? `<small>${vehicleInfo.brand} ${vehicleInfo.model}</small>` : ''}
        `;
        
        document.getElementById('vehicleResult').classList.remove('hidden');
        document.getElementById('vehicleResult').scrollIntoView({ behavior: 'smooth' });
      }, 800);
    }

    function showPlans() {
      document.getElementById('vehicleResult').classList.add('hidden');
      
      const plansContainer = document.getElementById('plans');
      plansContainer.innerHTML = '';
      
      plansData.forEach(plan => {
        const planDiv = document.createElement('div');
        planDiv.className = `plan ${plan.highlight ? 'highlight' : ''} ${plan.ev ? 'ev' : ''}`;
        
        planDiv.innerHTML = `
          <h4>${plan.name}</h4>
          <p>${plan.desc}</p>
          <span class="price">${plan.price}â‚¬</span>
          <button onclick="selectPlan('${plan.name}', ${plan.price})">
            ${plan.ev ? 'ðŸ”‹ ' : 'â›½ '}Abbonati
          </button>
        `;
        
        plansContainer.appendChild(planDiv);
      });
      
      plansContainer.classList.remove('hidden');
      plansContainer.scrollIntoView({ behavior: 'smooth' });
    }

    function selectPlan(planName, price) {
      selectedPlan = { name: planName, price: price };
      
      // Mostra sezione pagamento
      document.getElementById('plans').classList.add('hidden');
      document.getElementById('paymentSection').classList.remove('hidden');
      
      // Aggiorna importo
      document.getElementById('paymentAmount').textContent = `${price}â‚¬`;
      
      // Inizializza Stripe Elements per pagamento con carta
      if (!cardElement) {
        cardElement = elements.create('card', {
          style: {
            base: {
              fontSize: '16px',
              color: '#ffffff',
              '::placeholder': { color: '#a0a0a0' }
            }
          }
        });
        cardElement.mount('#card-element');
        
        cardElement.on('change', (event) => {
          const displayError = document.getElementById('card-errors');
          if (event.error) {
            displayError.textContent = event.error.message;
          } else {
            displayError.textContent = '';
          }
        });
      }
      
      // Seleziona di default carta di credito
      selectPaymentMethod('card');
      
      document.getElementById('paymentSection').scrollIntoView({ behavior: 'smooth' });
    }

    function selectPaymentMethod(method) {
      selectedPaymentMethod = method;
      
      // Rimuovi selected da tutti
      ['cardMethod', 'paypalMethod', 'appleMethod', 'googleMethod'].forEach(id => {
        document.getElementById(id).classList.remove('selected');
      });
      
      // Aggiungi selected al metodo scelto
      document.getElementById(method + 'Method').classList.add('selected');
      
      // Mostra solo il form relativo
      ['cardForm', 'paypalButton', 'applePayButton', 'googlePayButton'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      
      document.getElementById(method === 'card' ? 'cardForm' : method + 'Button').classList.remove('hidden');
    }

    // ===== FUNZIONI DI PAGAMENTO REALI =====
    async function processPayment() {
      const payButton = document.getElementById('payButton');
      const cardholderName = document.getElementById('cardholder-name').value;
      const email = document.getElementById('email').value;
      
      if (!cardholderName || !email) {
        alert("Compila tutti i campi richiesti");
        return;
      }
      
      payButton.innerHTML = '<span class="loading"></span> Elaborazione pagamento...';
      payButton.disabled = true;
      
      try {
        // 1. CREA PAYMENT INTENT (backend call simulato)
        // In produzione, qui chiameresti il tuo backend:
        // const response = await fetch('/create-payment-intent', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify({ amount: selectedPlan.price * 100, currency: 'eur' })
        // });
        // const { clientSecret } = await response.json();
        
        // Simuliamo la risposta
        const clientSecret = 'pi_3OgE..._simulato'; // Sostituire con client secret reale
        
        // 2. CONFERMA PAGAMENTO
        const { paymentIntent, error } = await stripe.confirmCardPayment(clientSecret, {
          payment_method: {
            card: cardElement,
            billing_details: { name: cardholderName, email: email }
          }
        });
        
        if (error) {
          throw new Error(error.message);
        }
        
        // 3. PAGAMENTO RIUSCITO
        paymentIntentId = paymentIntent.id;
        showConfirmation();
        
      } catch (error) {
        alert(`Errore nel pagamento: ${error.message}`);
        payButton.innerHTML = '<i class="fas fa-lock"></i> Paga ora';
        payButton.disabled = false;
      }
    }

    function processPayPal() {
      // In produzione: reindirizza a PayPal o usa PayPal JS SDK
      alert("Reindirizzamento a PayPal... (simulato)");
      
      // Simula pagamento riuscito dopo 2 secondi
      setTimeout(() => {
        paymentIntentId = 'PAYPAL-' + Date.now();
        showConfirmation();
      }, 2000);
    }

    function processApplePay() {
      if (!window.ApplePaySession) {
        alert("Apple Pay non disponibile su questo dispositivo");
        return;
      }
      
      alert("Apple Pay attivato... (simulato)");
      setTimeout(() => {
        paymentIntentId = 'APPLE-' + Date.now();
        showConfirmation();
      }, 2000);
    }

    function processGooglePay() {
      if (!window.PaymentRequest) {
        alert("Google Pay non disponibile su questo dispositivo");
        return;
      }
      
      alert("Google Pay attivato... (simulato)");
      setTimeout(() => {
        paymentIntentId = 'GOOGLE-' + Date.now();
        showConfirmation();
      }, 2000);
    }

    function showConfirmation() {
      document.getElementById('paymentSection').classList.add('hidden');
      
      document.getElementById('summary').innerHTML = `
        <strong>${selectedPlan.name}</strong><br>
        Importo: <strong>${selectedPlan.price}â‚¬</strong><br>
        Metodo: <strong>${selectedPaymentMethod.toUpperCase()}</strong><br>
        Data: <strong>${new Date().toLocaleDateString('it-IT')}</strong>
      `;
      
      document.getElementById('transactionId').textContent = paymentIntentId || 'TRX-' + Date.now();
      document.getElementById('confirmation').classList.remove('hidden');
      document.getElementById('confirmation').scrollIntoView({ behavior: 'smooth' });
    }

    function resetFlow() {
      // Reset tutte le sezioni
      ['vehicleResult', 'plans', 'paymentSection', 'confirmation'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      
      // Reset input
      document.getElementById('plate').value = '';
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      // Reset variabili
      selectedPlan = null;
      selectedPaymentMethod = 'card';
      paymentIntentId = null;
    }

    // ===== SETUP INIZIALE =====
    document.addEventListener('DOMContentLoaded', () => {
      // Setup tasto Enter per analisi targa
      document.getElementById('plate').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') detectVehicle();
      });
    });
  </script>
</body>
</html>
